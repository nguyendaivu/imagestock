<?php

class State extends BaseModel {

	protected $table = 'states';

    public function country() {
    	return $this->hasOne('Country', 'a2', 'country_a2');
    }
    
    /**
     * Fetch one (fist one it finds) state/province matching it's 2 digit alpha-code. Searches US states first, then all countries.
     * Pass in countryA2 code to look for exact state/province
     *  
     * @param $string $code
     * @param string $countryA2
     */
    public static function scopeByCode($query, $code) {
    	return $query->where('a2', '=', $code);
    }

    /**
     * Fetch one (fist one it finds) state/province matching it's 2 digit alpha-code. Searches US states first, then all countries.
     * Pass in countryA2 code to look for exact state/province
     *
     * @param $string $code
     * @param string $countryA2
     */
    public function scopeByCountry($query, $countryCode) {
    	if(strlen($countryCode) == 2) {
    		return $query->where('country_a2', '=', $countryCode);
    	}
    	
    	throw new \Exception('Must Use 2-Digit Alpha-Code to find a State');
    }

}